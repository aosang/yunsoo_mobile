{"version":3,"file":"workorderDetails.js","sources":["pages/workorderDetails/workorderDetails.vue","D:/software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvd29ya29yZGVyRGV0YWlscy93b3Jrb3JkZXJEZXRhaWxzLnZ1ZQ"],"sourcesContent":["<template>\r\n\t<Navigation/>\r\n\t<wd-toast />\r\n\t<view class=\"workorder_details\">\r\n\t\t<wd-navbar\r\n\t\t\ttitle=\"工单详情\" \r\n\t\t\tfixed \r\n\t\t\tcustom-class=\"custom\"\r\n\t\t\tleft-arrow\r\n\t\t\tleft-text=\"返回\"\r\n\t\t\tright-text=\"确认更新\"\r\n\t\t\tcustom-style=\"color: #fff\"\r\n\t\t\t@click-left=\"backToWorkorderList\"\r\n\t\t\t@click-right=\"updateWorkorderData\"\r\n\t\t>\r\n\t\t</wd-navbar>\r\n\t</view>\r\n\t<view class=\"workorder_details_form\">\r\n\t\t<view class=\"workorder_form_item\">\r\n\t\t\t<view class=\"workorder_form_time\">\r\n\t\t\t\t<view>设备名称</view>\r\n\t\t\t\t<view class=\"workorder_form_value\">\r\n\t\t\t\t\t{{workorderEditForm.created_product}}\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"workorder_form_item\">\r\n\t\t\t<wd-select-picker\r\n\t\t\t\tlabel=\"当前状态\" \r\n\t\t\t\tv-model=\"workorderEditForm.created_status\" \r\n\t\t\t\t:columns=\"workorderStatus\" \r\n\t\t\t\t:z-index=\"1000\"\r\n\t\t\t\ttype=\"radio\" \r\n\t\t\t\tlabel-key=\"value\"\r\n\t\t\t\tvalue-key=\"value\"\r\n\t\t\t\tcustom-class=\"custom_select\"\r\n\t\t\t\tcustom-label-class=\"custom_label\"\r\n\t\t\t\tcustom-value-class=\"custom_value\"\r\n\t\t\t\tcustom-content-class=\"custom_content\"\r\n\t\t\t\tplaceholder=\"请选择当前状态\"\r\n\t\t\t\tclearable\r\n\t\t\t\t@confirm=\"confirmSelectStatus\"\r\n\t\t\t>\r\n\t\t\t</wd-select-picker>\r\n\t\t</view>\r\n\t\t<view class=\"workorder_form_item\">\r\n\t\t\t<view class=\"workorder_form_time\">\r\n\t\t\t\t<view>设备类型</view>\r\n\t\t\t\t<view class=\"workorder_form_value\">\r\n\t\t\t\t\t{{workorderEditForm.created_type}}\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"workorder_form_item\">\r\n\t\t\t<view class=\"workorder_form_time\">\r\n\t\t\t\t<view>设备品牌</view>\r\n\t\t\t\t<view class=\"workorder_form_value\">{{workorderEditForm.created_brand}}</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"workorder_form_item\">\r\n\t\t\t<view class=\"workorder_form_time\">\r\n\t\t\t\t<view>创建时间</view>\r\n\t\t\t\t<view class=\"workorder_form_value\">{{workorderEditForm.created_time}}</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"workorder_form_item\">\r\n\t\t\t<view class=\"workorder_form_time\">\r\n\t\t\t\t<view>更新时间</view>\r\n\t\t\t\t<view class=\"workorder_form_value\">{{workorderEditForm.created_update}}</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n\t<!-- 问题描述 -->\r\n\t<view class=\"created_textarea\">\r\n\t\t<view class=\"created_textarea_label\">问题描述</view>\r\n\t\t<wd-textarea\r\n\t\t\t:adjust-position=\"false\"\r\n\t\t\t:maxlength=\"260\"\r\n\t\t\tv-model=\"workorderEditForm.created_text\"\r\n\t\t\tplaceholder=\"填写问题描述\"\r\n\t\t\tcustom-textarea-class=\"custom-desc\"\r\n\t\t\tclearable \r\n\t\t\tshow-word-limit\r\n\t\t/>\r\n\t</view>\r\n\t<view \r\n\t\tclass=\"created_textarea\" \r\n\t\tv-if=\"workorderEditForm.created_status === '已解决'\"\r\n\t>\r\n\t\t<view class=\"created_textarea_label\">解决方案</view>\r\n\t\t<wd-textarea\r\n\t\t\t:adjust-position=\"false\"\r\n\t\t\t:maxlength=\"260\"\r\n\t\t\tv-model=\"workorderEditForm.created_solved\"\r\n\t\t\tplaceholder=\"填写解决方案\"\r\n\t\t\tcustom-textarea-class=\"custom-desc\"\r\n\t\t\tclearable \r\n\t\t\tshow-word-limit\r\n\t\t/>\r\n\t</view>\r\n\t<view class=\"created_textarea\">\r\n\t\t<view class=\"created_textarea_label\">备注信息</view>\r\n\t\t<wd-textarea\r\n\t\t\t:adjust-position=\"false\"\r\n\t\t\t:maxlength=\"120\"\r\n\t\t\tv-model=\"workorderEditForm.created_remark\"\r\n\t\t\tplaceholder=\"填写备注\"\r\n\t\t\tcustom-textarea-class=\"custom-desc\"\r\n\t\t\tclearable \r\n\t\t\tshow-word-limit\r\n\t\t/>\r\n\t</view>\r\n\r\n\t<view\r\n\t\tclass=\"whiteBox\" \r\n\t\tstyle=\"height: 500rpx;\"\r\n\t\tv-show=\"isScroll\"\r\n\t>\r\n\t</view>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\n\timport Navigation from '@/components/navigation_header.vue'\r\n\timport { onLoad } from '@dcloudio/uni-app'\r\n\timport { requestMethods } from '@/request/request'\r\n\timport { reactive, ref, onMounted, nextTick, watch } from 'vue'\r\n\timport { useToast } from '@/uni_modules/wot-design-uni'\r\n\tconst toast = useToast()\r\n\timport { formatTime } from '@/request/formatTime'\r\n\t\r\n\tconst workorderStatus = ref<Record<string, any>> ([])\r\n\tconst updateId = ref('')\r\n\tconst isUpdate = ref<boolean>(false)\r\n\tconst isScroll = ref<boolean>(false)\r\n\tconst workorderEditForm = reactive({\r\n\t\tcreated_id: '',\r\n\t\tcreated_product:'',\r\n\t\tcreated_name: '',\r\n\t\tcreated_time: '',\r\n\t\tcreated_update: '',\r\n\t\tcreated_solved: '',\r\n\t\tcreated_type: '',\r\n\t\tcreated_brand: '',\r\n\t\tcreated_status:'',\r\n\t\tcreated_text:'',\r\n\t\tcreated_remark:''\r\n\t})\r\n\r\n\tonLoad((options) => {\r\n\t\tgetWorkorderDatailsData(options.workId)\r\n\t\tworkorderEditForm.created_id = options.workId\r\n\t})\r\n\t\r\n\tonMounted(() => {\r\n\t\tnextTick(() => {\r\n\t\t\tgetWorkorderStatus()\r\n\t\t})\r\n\t})\r\n\t\r\n\tconst confirmSelectStatus = (event: any) => {\r\n\t\tworkorderEditForm.created_status = event.value\r\n\t\tif(event.value !== '已解决') {\r\n\t\t\tworkorderEditForm.created_solved = ''\r\n\t\t}\r\n\t}\r\n\t\r\n\tconst handlerChange = (event: any) => {\r\n\t\tconst height:number = event.height\r\n\t\tif(height > 0) {\r\n\t\t\tisScroll.value = true\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tuni.createSelectorQuery().select('.whiteBox').boundingClientRect((rect:any) => {\r\n\t\t\t\t\tuni.pageScrollTo({\r\n\t\t\t\t\t\tscrollTop: rect.top,\r\n\t\t\t\t\t\tduration: 50,\r\n\t\t\t\t\t})\r\n\t\t\t\t}).exec()\r\n\t\t\t}, 100)\r\n\t\t}else if( height === 0) {\r\n\t\t\tisScroll.value = false\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tuni.createSelectorQuery().select('.workorder_details_form').boundingClientRect((rect:any) => {\r\n\t\t\t\t\tuni.pageScrollTo({\r\n\t\t\t\t\t\tscrollTop: rect.top,\r\n\t\t\t\t\t\tduration: 50,\r\n\t\t\t\t\t})\r\n\t\t\t\t}).exec()\r\n\t\t\t}, 100)\r\n\t\t}\r\n\t}\r\n\t\r\n\tconst getWorkorderStatus = async () => {\r\n\t\tlet res = await requestMethods('/GetStatus', 'GET')\r\n\t\tworkorderStatus.value = res.data\r\n\t}\r\n\t\r\n\t// 获取工单详情数据\r\n\tconst getWorkorderDatailsData = async (id: string) => {\r\n\t\tlet res = await requestMethods('/GetWorkorderDetail', 'GET', {\r\n\t\t\tworkDetailId: id\r\n\t\t})\r\n\t\tif(res.code === 200) {\r\n\t\t\tworkorderEditForm.created_product = res.data[0].created_product\r\n\t\t\tworkorderEditForm.created_status = res.data[0].created_status\r\n\t\t\tworkorderEditForm.created_type = res.data[0].created_type\r\n\t\t\tworkorderEditForm.created_brand = res.data[0].created_brand\r\n\t\t\tworkorderEditForm.created_time = res.data[0].created_time\r\n\t\t\tworkorderEditForm.created_update = formatTime()\r\n\t\t\tworkorderEditForm.created_text = res.data[0].created_text\r\n\t\t\tworkorderEditForm.created_solved = res.data[0].created_solved\r\n\t\t\tworkorderEditForm.created_remark = res.data[0].created_remark\r\n\t\t\t\r\n\t\t\tuni.setStorageSync('saveData', res.data[0])\r\n\t\t}else {\r\n\t\t\ttoast.error('获取数据失败')\r\n\t\t}\r\n\t}\r\n\t\r\n\tconst updateWorkorderData = async () => {\r\n\t\tconst {created_text, created_solved, created_status} = workorderEditForm\r\n\t\tif(!created_text || !created_status) {\r\n\t\t\ttoast.error('请填写完整信息')\r\n\t\t}else if(created_status === '已解决' && !created_solved) {\r\n\t\t\ttoast.error('请填写完整信息')\r\n\t\t}else {\r\n\t\t\tif(checkUpdateValue()) {\r\n\t\t\t\tlet res = await requestMethods('/UpdateWorkorder', 'POST', workorderEditForm)\r\n\t\t\t\tif(res.code === 200) {\r\n\t\t\t\t\ttoast.show({\r\n\t\t\t\t\t\ticonName: 'success',\r\n\t\t\t\t\t\tmsg: '更新成功',\r\n\t\t\t\t\t\tduration: 800,\r\n\t\t\t\t\t\tclosed: () => {\r\n\t\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\t\turl: '/pages/workorder/workorder' \r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tuni.$emit('refreshData')\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}else {\r\n\t\t\t\t\ttoast.error('新增工单失败')\r\n\t\t\t\t\tuni.__f__('log','at pages/workorderDetails/workorderDetails.vue:242',res)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tconst checkUpdateValue = () => {\r\n\t\tlet saveData = uni.getStorageSync('saveData')\r\n\t\tconst {created_status, created_text, created_solved, created_remark} = workorderEditForm\r\n\t\t\r\n\t\tif(saveData.created_status === created_status && saveData.created_text === created_text && saveData.created_solved === created_solved && saveData.created_remark === created_remark) {\r\n\t\t\ttoast.show('内容未修改，请修改后提交')\r\n\t\t\treturn isUpdate.value = false\r\n\t\t}else {\r\n\t\t\treturn isUpdate.value = true\r\n\t\t}\r\n\t}\r\n\t\r\n\tconst backToWorkorderList = () => {\r\n\t\tuni.navigateBack({\r\n\t\t\tsuccess: () => {\r\n\t\t\t\tworkorderEditForm.created_remark = ''\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t\r\n</script>\r\n\r\n<style lang=\"scss\">\r\nhtml, body {\r\n\theight: 100vh;\r\n\tbackground: #f3f3f3;\r\n}\t\r\n\t\r\n.workorder_details {\r\n\twidth: 100%;\r\n\t:deep() {\r\n\t\t.custom {\r\n\t\t\tbackground-color: #2a6fff;\r\n\t\t\tmargin-top: 88rpx;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n.workorder_details_form {\r\n\tbackground: #fff;\r\n\tpadding-top: 190rpx;\r\n\t\r\n\t:deep() {\r\n\t\t.custom_label {\r\n\t\t\tfont-size: 28rpx;\r\n\t\t\tmargin-top: 4rpx;\r\n\t\t}\r\n\t\t.custom_value {\r\n\t\t\tfont-size: 28rpx;\r\n\t\t\tmargin-top: 4rpx;\r\n\t\t}\r\n\t\t.custom_select {\r\n\t\t\theight: 90rpx;\r\n\t\t\tborder-bottom: 1px solid #eee;\r\n\t\t}\r\n\t}\r\n\t.workorder_form_time {\r\n\t\theight: 90rpx;\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #333;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tpadding: 0 30rpx;\r\n\t\tborder-bottom: 1px solid #eee;\r\n\t\t\r\n\t\t.workorder_form_value {\r\n\t\t\tmargin-left: 138rpx;\r\n\t\t\tfont-size: 28rpx;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n.created_textarea {\r\n\tmargin-top: 24rpx;\r\n\tbackground: #fff;\r\n\t\r\n\t.created_textarea_label {\r\n\t\tpadding: 28rpx 28rpx 0 28rpx;\r\n\t\tcolor: #333;\r\n\t\tfont-size: 28rpx;\r\n\t}\r\n\t:deep() {\r\n\t\t.custom-desc {\r\n\t\t\tmax-height: 140rpx;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tfont-size: 28rpx;\r\n\t\t}\r\n\t}\r\n}\r\n</style>\r\n","import MiniProgramPage from 'F:/yunsoo_mobile/pages/workorderDetails/workorderDetails.vue'\nwx.createPage(MiniProgramPage)"],"names":["useToast","ref","reactive","onLoad","onMounted","nextTick","requestMethods","formatTime","uni","MiniProgramPage"],"mappings":"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"}