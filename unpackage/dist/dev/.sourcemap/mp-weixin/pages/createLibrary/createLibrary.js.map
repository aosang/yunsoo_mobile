{"version":3,"file":"createLibrary.js","sources":["pages/createLibrary/createLibrary.vue","D:/software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY3JlYXRlTGlicmFyeS9jcmVhdGVMaWJyYXJ5LnZ1ZQ"],"sourcesContent":["<template>\r\n\t<Navigation />\r\n\t<wd-toast />\r\n\t<view></view>\r\n\t<view v-show=\"isPreview\">\r\n\t\t<view class=\"created_library\">\r\n\t\t\t<wd-navbar \r\n\t\t\t\ttitle=\"编辑知识库内容\" \r\n\t\t\t\tfixed \r\n\t\t\t\tcustom-class=\"custom\" \r\n\t\t\t\tleft-text=\"返回\"\r\n\t\t\t\tright-text=\"预览\"\r\n\t\t\t\tleft-arrow\r\n\t\t\t\t:zIndex=\"10\"\r\n\t\t\t\t@click-left=\"backToLibraryList\"\r\n\t\t\t\t@click-right=\"submitLibraryFormEvent\"\r\n\t\t\t>\r\n\t\t\t</wd-navbar>\r\n\t\t</view>\r\n\t\t<view class=\"container\">\r\n\t\t\t<view class=\"page-body\">\r\n\t\t\t\t<view class='wrapper'>\r\n\t\t\t\t\t <sp-editor\r\n\t\t\t\t\t :toolbar-config=\"{\r\n\t\t\t\t\t\t keys: ['bold', 'underline', 'listOrdered', 'listBullet', 'image', 'undo', 'redo', 'clear'],\r\n\t\t\t\t\t\t iconSize: '18px'\r\n\t\t\t\t\t\t}\"\r\n\t\t\t\t\t\tplaceholder=\"想要分享的内容\"\r\n\t\t\t\t\t\t@input=\"inputContentHtml\"\r\n\t\t\t\t\t\t@upinImage=\"upinImage\"\r\n\t\t\t\t\t\t@init=\"initEditor\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t</sp-editor>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n\t<!-- 预览 -->\r\n\t<view class=\"preview_box\" v-show=\"!isPreview\">\r\n\t\t<wd-skeleton\r\n\t\t\t:loading=\"isSkeleton\"\r\n\t\t\t:custom-style=\"{ marginTop: '20px' }\" \r\n\t\t\t:row-col=\"imageGroup\" \r\n\t\t/>\r\n\t\t<view v-show=\"!isSkeleton\">\r\n\t\t\t<view class=\"preview_title\">{{libraryStore.libraryTitle}}</view>\r\n\t\t\t<view class=\"preview_info\">\r\n\t\t\t\t<text>{{libraryStore.libraryAuthor}}</text>\r\n\t\t\t\t<text>{{dayjs(libraryStore.libraryTime).format('YYYY-MM-DD')}}</text>\r\n\t\t\t\t<text>{{libraryStore.libraryTypeValue}}</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"preview_line\"></view>\r\n\t\t\t<view class=\"preview_html\" v-html=\"libraryStore.libraryHtml\"></view>\r\n\t\t\t<!-- 底部tab -->\r\n\t\t\t<view class=\"preview_tab\">\r\n\t\t\t\t<wd-button \r\n\t\t\t\t\tcustom-class=\"custom-radius\" \r\n\t\t\t\t\ttype=\"warning\"\r\n\t\t\t\t\ticon=\"time-filled\"\r\n\t\t\t\t\t@click=\"backToEditLibrary\"\r\n\t\t\t\t>\r\n\t\t\t\t\t再修改一下\r\n\t\t\t\t</wd-button>\r\n\t\t\t\t<wd-button \r\n\t\t\t\t\tcustom-class=\"custom-radius\"\r\n\t\t\t\t\ticon=\"check-circle-filled\"\r\n\t\t\t\t\t@click=\"addLibraryFormData\"\r\n\t\t\t\t>\r\n\t\t\t\t\t发布到知识库\r\n\t\t\t\t</wd-button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n\t\r\n</template>\r\n\r\n<script setup>\r\nimport dayjs from 'dayjs'\r\nimport { onLoad } from '@dcloudio/uni-app'\r\nimport { ref, nextTick, reactive, onMounted, toRaw } from 'vue'\r\nimport Navigation from '@/components/navigation_header.vue'\r\nimport { getTimenumber } from '@/request/formatTime'\r\nimport { requestMethods, uploadMethods } from '@/request/request'\r\nimport { useToast } from '@/uni_modules/wot-design-uni'\r\nconst toast = useToast()\r\nimport { userInfoStore } from \"@/stores/userInfo\"\r\nconst userStore = userInfoStore()\r\nimport { libraryFormStore } from \"@/stores/libraryForm\"\r\nconst libraryStore = libraryFormStore()\r\n\r\nconst imageGroup = [1, 1, { width: '200px' }, { height: '170px' }, 1, 1, 1, 1, { width: '200px' }]\r\nconst isSkeleton = ref(true)\r\nconst editorIns = ref(null)\r\nconst formats = ref({})\r\nconst editorCtx = ref(null)\r\nconst libraryType = ref([])\r\nconst isPreview = ref(true)\r\nconst statusNumber = ref(1)\r\n\r\nonMounted(() => {\r\n\t// console.log(libraryStore.$state, null, 2)\r\n})\r\n\r\nconst inputContentHtml = (e) => {\r\n\tif (e && e.html) {\r\n\t\tlibraryStore.libraryHtml = e.html\r\n\t}\r\n}\r\n\r\n// 上传图片\r\nconst upinImage = async (tempFiles, editorCtx) => {\r\n\tif (!tempFiles || !tempFiles[0] || !editorCtx) {\r\n\t\ttoast.error('图片上传参数错误')\r\n\t\treturn\r\n\t}\r\n\ttry {\r\n\t\tconst res = await uploadMethods('/uploadLibraryImage', tempFiles[0].path)\r\n\t\tif (res.data.url) {\r\n\t\t\teditorCtx.insertImage({\r\n\t\t\t\tsrc: res.data.url,\r\n\t\t\t\twidth: '90%',\r\n\t\t\t\tsuccess() {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\ttitle: '图片上传成功'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ticon: 'none',\r\n\t\t\t\ttitle: '上传返回异常'\r\n\t\t\t})\r\n\t\t}\r\n\t} catch (err) {\r\n\t\tconsole.error('图片上传失败', err)\r\n\t\tuni.showToast({\r\n\t\t\ticon: 'none',\r\n\t\t\ttitle: '图片上传失败'\r\n\t\t})\r\n\t}\r\n}\r\n\r\nconst initEditor = (editor) => {\r\n\tif (editor) {\r\n\t\teditorIns.value = editor\r\n\t\t// 保存编辑器实例后，可以在此处获取后端数据，并赋值给编辑器初始化内容\r\n\t\tpreRender()\r\n\t}\r\n}\r\n\r\nconst preRender = () => {\r\n\tif (editorIns.value && editorIns.value.setContents) {\r\n\t\tsetTimeout(() => {\r\n\t\t\t// 异步获取后端数据后，初始化编辑器内容\r\n\t\t\ttry {\r\n\t\t\t\teditorIns.value.setContents({\r\n\t\t\t\t\thtml: libraryStore.libraryHtml || ''\r\n\t\t\t\t\t// html: ''\r\n\t\t\t\t})\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('编辑器内容设置失败:', error)\r\n\t\t\t}\r\n\t\t}, 1000)\r\n\t}\r\n}\r\n\r\n// 确认提交知识库表单\r\nconst submitLibraryFormEvent = () => {\r\n\tif(!libraryStore.libraryHtml) {\r\n\t\ttoast.info('请填写知识库内容')\r\n\t}else{\r\n\t\tsetTimeout(() => {\r\n\t\t\tisSkeleton.value = false\r\n\t\t}, 1000)\r\n\t\tisPreview.value = false\r\n\t\tuni.pageScrollTo({\r\n\t\t\tduration: 0,\r\n\t\t\tscrollTop: 0\r\n\t\t})\r\n\t}\r\n}\r\n\r\nconst backToEditLibrary = () => {\r\n\tisPreview.value = true\r\n}\r\n\r\nconst addLibraryFormData = async () => {\r\n\ttry {\r\n\t\tlet res = await requestMethods('/addLibrary', 'POST', libraryStore)\r\n\t\tif(res.code === 200) {\r\n\t\t\ttoast.show({\r\n\t\t\t\ticonName: 'success',\r\n\t\t\t\tmsg: '新增知识库成功',\r\n\t\t\t\tduration: 800,\r\n\t\t\t\tclosed: () => {\r\n\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\turl: '/pages/libraryList/libraryList?success=' + statusNumber.value,\r\n\t\t\t\t\t\tsuccess() {\r\n\t\t\t\t\t\t\tuni.$emit('refreshData')\r\n\t\t\t\t\t\t\tlibraryStore.clearLibrary()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}else {\r\n\t\t\ttoast.error('新增知识库失败')\r\n\t\t}\r\n\t} catch (error) {\r\n\t\tconsole.error('提交知识库失败:', error)\r\n\t\ttoast.error('提交知识库失败')\r\n\t}\r\n}\r\n\r\nconst backToLibraryList = () => {\r\n\tuni.navigateBack()\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t@import \"@/static/css/editor-icon.css\";\r\n\t\r\n\thtml, body {\r\n\t\tbackground: #f3f3f3;\r\n\t}\r\n\t\r\n\t.created_library {\r\n\t\t:deep() {\r\n\t\t\twidth: 100%;\r\n\t\t\tmargin: 40rpx auto 0 auto;\r\n\t\t\t.custom {\r\n\t\t\t\tbackground-color: #2a6fff;\r\n\t\t\t\tmargin-top: 88rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.page-body {\r\n\t\theight: calc(100vh - var(--window-top) - var(--status-bar-height));\r\n\t\tmargin-top: 172rpx;\r\n\t\t\r\n\t\t.commonInput {\r\n\t\t\twidth: 100%;\r\n\t\t\tdisplay: block;\r\n\t\t\tfont-size: 28rpx;\r\n\t\t\tmargin: 0 auto;\r\n\t\t}\r\n\t\t\r\n\t\t.commonInputWidth {\r\n\t\t\twidth: 100%;\r\n\t\t\tpadding: 6rpx 30rpx;\r\n\t\t\tmargin-bottom: 10rpx;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t}\r\n\t\r\n\t\t.custom_select {\r\n\t\t\tfont-size: 28rpx;\r\n\t\t\t\r\n\t\t\t.custom_select_value {\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tpadding: 0 30rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.wrapper {\r\n\t\tposition: fixed;\r\n\t\ttop: 172rpx;\r\n\t\tleft: 0;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\t// margin-top: 20rpx;\r\n\t}\r\n\r\n\t.editor-wrapper {\r\n\t\theight: calc(100vh - var(--window-top) - var(--status-bar-height) - 140px);\r\n\t\tbackground: #fff;\r\n\t}\r\n\r\n\t.iconfont {\r\n\t\tdisplay: inline-block;\r\n\t\tpadding: 24rpx 42rpx;\r\n\t\twidth: 24px;\r\n\t\theight: 24px;\r\n\t\tcursor: pointer;\r\n\t\tfont-size: 36rpx;\r\n\t\tbox-sizing: border-box;\r\n\t}\r\n\r\n\t.toolbar {\r\n\t\twidth: 100%;\r\n\t\tposition: fixed;\r\n\t\tbottom: 0;\r\n\t\tbox-sizing: border-box;\r\n\t\tborder-bottom: 0;\r\n\t\tfont-family: 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif;\r\n\t\tborder-top: 1px solid #ccc;\r\n\t}\r\n\r\n\t.ql-container {\r\n\t\tbox-sizing: border-box;\r\n\t\tpadding: 24rpx 24rpx;\r\n\t\twidth: 100%;\r\n\t\tmax-height: 1200rpx;\r\n\t\t// height: 100%;\r\n\t\tfont-size: 28rpx;\r\n\t\tline-height: 1.5;\r\n\t}\r\n\r\n\t.ql-active {\r\n\t\tcolor: #06c;\r\n\t}\r\n\t\r\n\t.active_style {\r\n\t\tcolor: #808080;\r\n\t}\r\n\t\r\n\t// 预览样式\r\n\t.preview_box {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tpadding: 30rpx;\r\n\t\tmargin-top: 60rpx;\r\n\t\tbox-sizing: border-box;\r\n\t\tbackground: #fff;\r\n\t\t\r\n\t\t.preview_title {\r\n\t\t\tfont-size: 32rpx;\r\n\t\t\tfont-weight: 650;\r\n\t\t\tcolor: #555;\r\n\t\t}\r\n\t\t\r\n\t\t.preview_info {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tline-height: 48rpx;\r\n\t\t\ttext {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tfont-size: 26rpx;\r\n\t\t\t\tcolor: #515567;\r\n\t\t\t\tmargin: 12rpx 30rpx 0 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t.preview_line {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 2rpx;\r\n\t\t\tbackground: #eee;\r\n\t\t\tmargin: 12rpx 0;\r\n\t\t}\r\n\t\t\r\n\t\t.preview_html {\r\n\t\t\tfont-size: 28rpx;\r\n\t\t\tcolor: #555;\r\n\t\t\t\r\n\t\t\timg {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tmargin: 6rpx auto;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t.preview_tab{\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: space-between;\r\n\t\tposition: fixed;\r\n\t\tbottom: 20rpx;\r\n\t\tleft: 0;\r\n\t\twidth: 100%;\r\n\t\theight: 110rpx;\r\n\t\tbackground: #eee;\r\n\t\tborder-top: 2rpx solid #cecece;\r\n\t\tpadding: 0 100rpx;\r\n\t\tbox-sizing: border-box;\r\n\t\tbackground: #fff;\r\n\t\t\r\n\t\t:deep() {\r\n\t\t\t.custom-radius {\r\n\t\t\t\tborder-radius: 20rpx !important;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n</style>","import MiniProgramPage from 'F:/yunsoo_mobile/pages/createLibrary/createLibrary.vue'\nwx.createPage(MiniProgramPage)"],"names":["useToast","userInfoStore","libraryFormStore","ref","onMounted","uploadMethods","uni","requestMethods","MiniProgramPage"],"mappings":"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"}