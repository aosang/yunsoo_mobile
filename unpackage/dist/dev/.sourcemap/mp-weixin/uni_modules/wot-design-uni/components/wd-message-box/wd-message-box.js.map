{"version":3,"file":"wd-message-box.js","sources":["uni_modules/wot-design-uni/components/wd-message-box/wd-message-box.vue","D:/software/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RjoveXVuc29vX21vYmlsZS91bmlfbW9kdWxlcy93b3QtZGVzaWduLXVuaS9jb21wb25lbnRzL3dkLW1lc3NhZ2UtYm94L3dkLW1lc3NhZ2UtYm94LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view>\r\n    <wd-popup\r\n      transition=\"zoom-in\"\r\n      v-model=\"messageState.show\"\r\n      :close-on-click-modal=\"messageState.closeOnClickModal\"\r\n      :lazy-render=\"messageState.lazyRender\"\r\n      custom-class=\"wd-message-box\"\r\n      @click-modal=\"toggleModal('modal')\"\r\n      :z-index=\"messageState.zIndex\"\r\n      :duration=\"200\"\r\n    >\r\n      <view :class=\"rootClass\">\r\n        <view :class=\"bodyClass\">\r\n          <view v-if=\"messageState.title\" class=\"wd-message-box__title\">\r\n            {{ messageState.title }}\r\n          </view>\r\n          <view class=\"wd-message-box__content\">\r\n            <template v-if=\"messageState.type === 'prompt'\">\r\n              <wd-input\r\n                v-model=\"messageState.inputValue\"\r\n                :type=\"messageState.inputType\"\r\n                :size=\"messageState.inputSize\"\r\n                :placeholder=\"messageState.inputPlaceholder\"\r\n                @input=\"inputValChange\"\r\n              />\r\n              <view v-if=\"messageState.showErr\" class=\"wd-message-box__input-error\">\r\n                {{ messageState.inputError || translate('inputNoValidate') }}\r\n              </view>\r\n            </template>\r\n            <slot>{{ messageState.msg }}</slot>\r\n          </view>\r\n        </view>\r\n        <view :class=\"`wd-message-box__actions ${messageState.showCancelButton ? 'wd-message-box__flex' : 'wd-message-box__block'}`\">\r\n          <wd-button v-bind=\"customCancelProps\" v-if=\"messageState.showCancelButton\" @click=\"toggleModal('cancel')\">\r\n            {{ messageState.cancelButtonText || translate('cancel') }}\r\n          </wd-button>\r\n          <wd-button v-bind=\"customConfirmProps\" @click=\"toggleModal('confirm')\">\r\n            {{ messageState.confirmButtonText || translate('confirm') }}\r\n          </wd-button>\r\n        </view>\r\n      </view>\r\n    </wd-popup>\r\n  </view>\r\n</template>\r\n<script lang=\"ts\">\r\nexport default {\r\n  name: 'wd-message-box',\r\n  options: {\r\n    virtualHost: true,\r\n    addGlobalClass: true,\r\n    styleIsolation: 'shared'\r\n  }\r\n}\r\n</script>\r\n\r\n<script lang=\"ts\" setup>\r\nimport wdPopup from '../wd-popup/wd-popup.vue'\r\nimport wdButton from '../wd-button/wd-button.vue'\r\nimport wdInput from '../wd-input/wd-input.vue'\r\nimport { computed, inject, reactive, ref, watch } from 'vue'\r\nimport { messageBoxProps, type MessageOptionsWithCallBack, type MessageResult } from './types'\r\nimport { defaultOptions, getMessageDefaultOptionKey } from '.'\r\nimport { deepAssign, isDef, isFunction, isUndefined, omitBy } from '../common/util'\r\nimport { useTranslate } from '../composables/useTranslate'\r\nimport type { ButtonProps } from '../wd-button/types'\r\n\r\nconst props = defineProps(messageBoxProps)\r\n\r\nconst { translate } = useTranslate('message-box')\r\n\r\nconst rootClass = computed(() => {\r\n  return `wd-message-box__container ${props.customClass}`\r\n})\r\n\r\nconst bodyClass = computed(() => {\r\n  return `wd-message-box__body ${!messageState.title ? 'is-no-title' : ''} ${messageState.type === 'prompt' ? 'is-prompt' : ''}`\r\n})\r\n\r\nconst messageOptionKey = getMessageDefaultOptionKey(props.selector)\r\nconst messageOption = inject(messageOptionKey, ref<MessageOptionsWithCallBack>(defaultOptions)) // message选项\r\n\r\nconst messageState = reactive<MessageOptionsWithCallBack>({\r\n  msg: '', // 消息内容\r\n  show: false, // 是否显示弹框\r\n  title: '', // 标题\r\n  showCancelButton: false, // 是否展示取消按钮\r\n  closeOnClickModal: true, // 是否支持点击蒙层关闭\r\n  confirmButtonText: '', // 确定按钮文案\r\n  cancelButtonText: '', // 取消按钮文案\r\n  type: 'alert', // 弹框类型\r\n  inputType: 'text', // 输入框类型\r\n  inputValue: '', // 输入框初始值\r\n  inputPlaceholder: '', // 输入框placeholder\r\n  inputError: '', // 输入框错误提示文案\r\n  showErr: false, // 是否显示错误提示\r\n  zIndex: 99, // 弹窗层级\r\n  lazyRender: true // 弹层内容懒渲染\r\n})\r\n\r\n/**\r\n * 确认按钮属性\r\n */\r\nconst customConfirmProps = computed(() => {\r\n  const buttonProps: Partial<ButtonProps> = deepAssign(\r\n    {\r\n      block: true\r\n    },\r\n    isDef(messageState.confirmButtonProps) ? omitBy(messageState.confirmButtonProps, isUndefined) : {}\r\n  )\r\n  buttonProps.customClass = `${buttonProps.customClass || ''} wd-message-box__actions-btn`\r\n  return buttonProps\r\n})\r\n\r\n/**\r\n * 取消按钮属性\r\n */\r\nconst customCancelProps = computed(() => {\r\n  const buttonProps: Partial<ButtonProps> = deepAssign(\r\n    {\r\n      block: true,\r\n      type: 'info'\r\n    },\r\n    isDef(messageState.cancelButtonProps) ? omitBy(messageState.cancelButtonProps, isUndefined) : {}\r\n  )\r\n  buttonProps.customClass = `${buttonProps.customClass || ''} wd-message-box__actions-btn`\r\n  return buttonProps\r\n})\r\n\r\n// 监听options变化展示\r\nwatch(\r\n  () => messageOption.value,\r\n  (newVal: MessageOptionsWithCallBack) => {\r\n    reset(newVal)\r\n  },\r\n  {\r\n    deep: true,\r\n    immediate: true\r\n  }\r\n)\r\n\r\nwatch(\r\n  () => messageState.show,\r\n  (newValue) => {\r\n    resetErr(!!newValue)\r\n  },\r\n  {\r\n    deep: true,\r\n    immediate: true\r\n  }\r\n)\r\n\r\n/**\r\n * 点击操作\r\n * @param action\r\n */\r\nfunction toggleModal(action: 'confirm' | 'cancel' | 'modal') {\r\n  if (action === 'modal' && !messageState.closeOnClickModal) {\r\n    return\r\n  }\r\n  if (messageState.type === 'prompt' && action === 'confirm' && !validate()) {\r\n    return\r\n  }\r\n  switch (action) {\r\n    case 'confirm':\r\n      if (messageState.beforeConfirm) {\r\n        messageState.beforeConfirm({\r\n          resolve: (isPass) => {\r\n            if (isPass) {\r\n              handleConfirm({\r\n                action: action,\r\n                value: messageState.inputValue\r\n              })\r\n            }\r\n          }\r\n        })\r\n      } else {\r\n        handleConfirm({\r\n          action: action,\r\n          value: messageState.inputValue\r\n        })\r\n      }\r\n      break\r\n    case 'cancel':\r\n      handleCancel({\r\n        action: action\r\n      })\r\n      break\r\n    default:\r\n      handleCancel({\r\n        action: 'modal'\r\n      })\r\n      break\r\n  }\r\n}\r\n\r\n/**\r\n * 确认回调\r\n * @param result\r\n */\r\nfunction handleConfirm(result: MessageResult) {\r\n  messageState.show = false\r\n  if (isFunction(messageState.success)) {\r\n    messageState.success(result)\r\n  }\r\n}\r\n\r\n/**\r\n * 取消回调\r\n * @param result\r\n */\r\nfunction handleCancel(result: MessageResult) {\r\n  messageState.show = false\r\n  if (isFunction(messageState.fail)) {\r\n    messageState.fail(result)\r\n  }\r\n}\r\n\r\n/**\r\n * 如果存在校验规则行为，则进行判断校验是否通过规则。默认不存在校验直接铜鼓。\r\n */\r\nfunction validate() {\r\n  if (messageState.inputPattern && !messageState.inputPattern.test(String(messageState.inputValue))) {\r\n    messageState.showErr = true\r\n    return false\r\n  }\r\n  if (typeof messageState.inputValidate === 'function') {\r\n    const validateResult = messageState.inputValidate(messageState.inputValue!)\r\n    if (!validateResult) {\r\n      messageState.showErr = true\r\n      return false\r\n    }\r\n  }\r\n  messageState.showErr = false\r\n  return true\r\n}\r\n\r\n/**\r\n * @description show关闭时，销毁错误提示\r\n * @param val\r\n */\r\nfunction resetErr(val: boolean) {\r\n  if (val === false) {\r\n    messageState.showErr = false\r\n  }\r\n}\r\nfunction inputValChange({ value }: { value: string | number }) {\r\n  if (value === '') {\r\n    messageState.showErr = false\r\n    return\r\n  }\r\n  messageState.inputValue = value\r\n}\r\n\r\n/**\r\n * 重置message选项值\r\n * @param option message选项值\r\n */\r\nfunction reset(option: MessageOptionsWithCallBack) {\r\n  if (option) {\r\n    messageState.title = isDef(option.title) ? option.title : ''\r\n    messageState.showCancelButton = isDef(option.showCancelButton) ? option.showCancelButton : false\r\n    messageState.show = option.show\r\n    messageState.closeOnClickModal = option.closeOnClickModal\r\n    messageState.confirmButtonText = option.confirmButtonText\r\n    messageState.cancelButtonText = option.cancelButtonText\r\n    messageState.msg = option.msg\r\n    messageState.type = option.type\r\n    messageState.inputType = option.inputType\r\n    messageState.inputSize = option.inputSize\r\n    messageState.inputValue = option.inputValue\r\n    messageState.inputPlaceholder = option.inputPlaceholder\r\n    messageState.inputPattern = option.inputPattern!\r\n    messageState.inputValidate = option.inputValidate\r\n    messageState.success = option.success\r\n    messageState.fail = option.fail\r\n    messageState.beforeConfirm = option.beforeConfirm\r\n    messageState.inputError = option.inputError\r\n    messageState.showErr = option.showErr\r\n    messageState.zIndex = option.zIndex\r\n    messageState.lazyRender = option.lazyRender\r\n    messageState.confirmButtonProps = option.confirmButtonProps\r\n    messageState.cancelButtonProps = option.cancelButtonProps\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import './index.scss';\r\n</style>\r\n","import Component from 'F:/yunsoo_mobile/uni_modules/wot-design-uni/components/wd-message-box/wd-message-box.vue'\nwx.createComponent(Component)"],"names":["useTranslate","computed","getMessageDefaultOptionKey","inject","ref","defaultOptions","reactive","deepAssign","isDef","omitBy","isUndefined","watch","isFunction"],"mappings":"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"}