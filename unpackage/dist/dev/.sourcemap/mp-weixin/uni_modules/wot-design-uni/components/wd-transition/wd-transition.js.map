{"version":3,"file":"wd-transition.js","sources":["uni_modules/wot-design-uni/components/wd-transition/wd-transition.vue","D:/software/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RjoveXVuc29vX21vYmlsZS91bmlfbW9kdWxlcy93b3QtZGVzaWduLXVuaS9jb21wb25lbnRzL3dkLXRyYW5zaXRpb24vd2QtdHJhbnNpdGlvbi52dWU"],"sourcesContent":["<template>\r\n  <view v-if=\"!lazyRender || inited\" :class=\"rootClass\" :style=\"style\" @transitionend=\"onTransitionEnd\" @click=\"handleClick\">\r\n    <slot />\r\n  </view>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nexport default {\r\n  name: 'wd-transition',\r\n  options: {\r\n    addGlobalClass: true,\r\n    virtualHost: true,\r\n    styleIsolation: 'shared'\r\n  }\r\n}\r\n</script>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { computed, onBeforeMount, ref, watch } from 'vue'\r\nimport { isObj, isPromise, pause } from '../common/util'\r\nimport { transitionProps, type TransitionName } from './types'\r\nimport { AbortablePromise } from '../common/AbortablePromise'\r\n\r\nconst getClassNames = (name?: TransitionName | TransitionName[]) => {\r\n  let enter: string = `${props.enterClass} ${props.enterActiveClass}`\r\n  let enterTo: string = `${props.enterToClass} ${props.enterActiveClass}`\r\n  let leave: string = `${props.leaveClass} ${props.leaveActiveClass}`\r\n  let leaveTo: string = `${props.leaveToClass} ${props.leaveActiveClass}`\r\n\r\n  if (Array.isArray(name)) {\r\n    for (let index = 0; index < name.length; index++) {\r\n      enter = `wd-${name[index]}-enter wd-${name[index]}-enter-active ${enter}`\r\n      enterTo = `wd-${name[index]}-enter-to wd-${name[index]}-enter-active ${enterTo}`\r\n      leave = `wd-${name[index]}-leave wd-${name[index]}-leave-active ${leave}`\r\n      leaveTo = `wd-${name[index]}-leave-to wd-${name[index]}-leave-active ${leaveTo}`\r\n    }\r\n  } else if (name) {\r\n    enter = `wd-${name}-enter wd-${name}-enter-active ${enter}`\r\n    enterTo = `wd-${name}-enter-to wd-${name}-enter-active ${enterTo}`\r\n    leave = `wd-${name}-leave wd-${name}-leave-active ${leave}`\r\n    leaveTo = `wd-${name}-leave-to wd-${name}-leave-active ${leaveTo}`\r\n  }\r\n  return {\r\n    enter: enter,\r\n    'enter-to': enterTo,\r\n    leave: leave,\r\n    'leave-to': leaveTo\r\n  }\r\n}\r\n\r\nconst props = defineProps(transitionProps)\r\nconst emit = defineEmits(['click', 'before-enter', 'enter', 'before-leave', 'leave', 'after-leave', 'after-enter'])\r\n\r\n// 初始化是否完成\r\nconst inited = ref<boolean>(false)\r\n// 是否显示\r\nconst display = ref<boolean>(false)\r\n// 当前动画状态\r\nconst status = ref<string>('')\r\n// 动画是否结束\r\nconst transitionEnded = ref<boolean>(false)\r\n// 动画持续时间\r\nconst currentDuration = ref<number>(300)\r\n// 类名\r\nconst classes = ref<string>('')\r\n// 用于控制enter和leave的顺序执行\r\nconst enterPromise = ref<AbortablePromise<void> | null>(null)\r\n\r\n// 动画进入的生命周期\r\nconst enterLifeCyclePromises = ref<AbortablePromise<unknown> | null>(null)\r\n\r\n// 动画离开的生命周期\r\nconst leaveLifeCyclePromises = ref<AbortablePromise<unknown> | null>(null)\r\n\r\nconst style = computed(() => {\r\n  return `-webkit-transition-duration:${currentDuration.value}ms;transition-duration:${currentDuration.value}ms;${\r\n    display.value || !props.destroy ? '' : 'display: none;'\r\n  }${props.customStyle}`\r\n})\r\n\r\nconst rootClass = computed(() => {\r\n  return `wd-transition ${props.customClass}  ${classes.value}`\r\n})\r\n\r\nonBeforeMount(() => {\r\n  if (props.show) {\r\n    enter()\r\n  }\r\n})\r\n\r\nwatch(\r\n  () => props.show,\r\n  (newVal) => {\r\n    handleShow(newVal)\r\n  },\r\n  { deep: true }\r\n)\r\n\r\nfunction handleClick() {\r\n  emit('click')\r\n}\r\n\r\nfunction handleShow(value: boolean) {\r\n  if (value) {\r\n    handleAbortPromise()\r\n    enter()\r\n  } else {\r\n    leave()\r\n  }\r\n}\r\n/**\r\n * 取消所有的promise\r\n */\r\nfunction handleAbortPromise() {\r\n  isPromise(enterPromise.value) && enterPromise.value.abort()\r\n  isPromise(enterLifeCyclePromises.value) && enterLifeCyclePromises.value.abort()\r\n  isPromise(leaveLifeCyclePromises.value) && leaveLifeCyclePromises.value.abort()\r\n  enterPromise.value = null\r\n  enterLifeCyclePromises.value = null\r\n  leaveLifeCyclePromises.value = null\r\n}\r\n\r\nfunction enter() {\r\n  enterPromise.value = new AbortablePromise(async (resolve) => {\r\n    try {\r\n      const classNames = getClassNames(props.name)\r\n      const duration = isObj(props.duration) ? (props.duration as any).enter : props.duration\r\n      status.value = 'enter'\r\n      emit('before-enter')\r\n      enterLifeCyclePromises.value = pause()\r\n      await enterLifeCyclePromises.value\r\n      emit('enter')\r\n      classes.value = classNames.enter\r\n      currentDuration.value = duration\r\n      enterLifeCyclePromises.value = pause()\r\n      await enterLifeCyclePromises.value\r\n      inited.value = true\r\n      display.value = true\r\n      enterLifeCyclePromises.value = pause()\r\n      await enterLifeCyclePromises.value\r\n      enterLifeCyclePromises.value = null\r\n      transitionEnded.value = false\r\n      classes.value = classNames['enter-to']\r\n      resolve()\r\n    } catch (error) {\r\n      /**\r\n       *\r\n       */\r\n    }\r\n  })\r\n}\r\nasync function leave() {\r\n  if (!enterPromise.value) {\r\n    transitionEnded.value = false\r\n    return onTransitionEnd()\r\n  }\r\n  try {\r\n    await enterPromise.value\r\n    if (!display.value) return\r\n    const classNames = getClassNames(props.name)\r\n    const duration = isObj(props.duration) ? (props.duration as any).leave : props.duration\r\n    status.value = 'leave'\r\n    emit('before-leave')\r\n    currentDuration.value = duration\r\n    leaveLifeCyclePromises.value = pause()\r\n    await leaveLifeCyclePromises.value\r\n    emit('leave')\r\n    classes.value = classNames.leave\r\n    leaveLifeCyclePromises.value = pause()\r\n    await leaveLifeCyclePromises.value\r\n    transitionEnded.value = false\r\n    classes.value = classNames['leave-to']\r\n    leaveLifeCyclePromises.value = setPromise(currentDuration.value)\r\n    await leaveLifeCyclePromises.value\r\n    leaveLifeCyclePromises.value = null\r\n    onTransitionEnd()\r\n    enterPromise.value = null\r\n  } catch (error) {\r\n    /**\r\n     *\r\n     */\r\n  }\r\n}\r\n\r\n/**\r\n * 定时器promise化\r\n * @param duration 持续时间ms\r\n */\r\nfunction setPromise(duration: number) {\r\n  return new AbortablePromise<void>((resolve) => {\r\n    const timer = setTimeout(() => {\r\n      clearTimeout(timer)\r\n      resolve()\r\n    }, duration)\r\n  })\r\n}\r\nfunction onTransitionEnd() {\r\n  if (transitionEnded.value) return\r\n\r\n  transitionEnded.value = true\r\n  if (status.value === 'leave') {\r\n    // 离开后触发\r\n    emit('after-leave')\r\n  } else if (status.value === 'enter') {\r\n    // 进入后触发\r\n    emit('after-enter')\r\n  }\r\n\r\n  if (!props.show && display.value) {\r\n    display.value = false\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n@import './index.scss';\r\n</style>\r\n","import Component from 'F:/yunsoo_mobile/uni_modules/wot-design-uni/components/wd-transition/wd-transition.vue'\nwx.createComponent(Component)"],"names":["enter","leave","ref","computed","onBeforeMount","watch","isPromise","AbortablePromise","isObj","pause"],"mappings":"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"}