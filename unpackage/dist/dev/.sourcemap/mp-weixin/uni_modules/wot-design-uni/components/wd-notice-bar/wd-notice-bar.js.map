{"version":3,"file":"wd-notice-bar.js","sources":["uni_modules/wot-design-uni/components/wd-notice-bar/wd-notice-bar.vue","D:/software/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RjoveXVuc29vX21vYmlsZS91bmlfbW9kdWxlcy93b3QtZGVzaWduLXVuaS9jb21wb25lbnRzL3dkLW5vdGljZS1iYXIvd2Qtbm90aWNlLWJhci52dWU"],"sourcesContent":["<template>\r\n  <view v-if=\"show\" :class=\"`wd-notice-bar ${customClass} ${noticeBarClass}`\" :style=\"rootStyle\">\r\n    <wd-icon v-if=\"prefix\" custom-class=\"wd-notice-bar__prefix\" :name=\"prefix\"></wd-icon>\r\n    <slot v-else name=\"prefix\"></slot>\r\n    <view class=\"wd-notice-bar__wrap\">\r\n      <view class=\"wd-notice-bar__content\" :style=\"animation\" @transitionend=\"animationEnd\" @click=\"handleClick\">\r\n        <template v-if=\"isVertical\">\r\n          <view v-for=\"item in textArray\" :key=\"item\">{{ item }}</view>\r\n          <view v-if=\"textArray.length > 1\">{{ textArray[0] }}</view>\r\n        </template>\r\n        <slot v-else>{{ currentText }}</slot>\r\n      </view>\r\n    </view>\r\n    <wd-icon v-if=\"closable\" custom-class=\"wd-notice-bar__suffix\" name=\"close-bold\" @click=\"handleClose\"></wd-icon>\r\n    <slot v-else name=\"suffix\"></slot>\r\n  </view>\r\n</template>\r\n<script lang=\"ts\">\r\nexport default {\r\n  name: 'wd-notice-bar',\r\n  options: {\r\n    virtualHost: true,\r\n    addGlobalClass: true,\r\n    styleIsolation: 'shared'\r\n  }\r\n}\r\n</script>\r\n\r\n<script lang=\"ts\" setup>\r\nimport wdIcon from '../wd-icon/wd-icon.vue'\r\nimport { ref, watch, nextTick, computed, getCurrentInstance, type CSSProperties, onMounted, onActivated, onDeactivated, reactive } from 'vue'\r\nimport { getRect, isArray, isDef, objToStyle } from '../common/util'\r\nimport { type NoticeBarExpose, noticeBarProps } from './types'\r\nconst $wrap = '.wd-notice-bar__wrap'\r\nconst $content = '.wd-notice-bar__content'\r\n\r\nconst props = defineProps(noticeBarProps)\r\nconst emit = defineEmits(['close', 'next', 'click'])\r\n\r\nconst wrapWidth = ref<number>(0)\r\nconst show = ref<boolean>(true)\r\nconst currentIndex = ref<number>(0)\r\nconst textArray = computed(() => (Array.isArray(props.text) ? props.text : [props.text]))\r\nconst currentText = computed(() => textArray.value[currentIndex.value])\r\nconst verticalIndex = ref<number>(0)\r\nconst wrapRect = ref<UniApp.NodeInfo | null>(null) // 外层容器节点信息\r\nconst contentRect = ref<UniApp.NodeInfo | null>(null) // 内容节点信息\r\nconst isHorizontal = computed(() => props.direction === 'horizontal')\r\nconst isVertical = computed(() => props.direction === 'vertical')\r\n\r\nconst transitionState = reactive<CSSProperties>({\r\n  transitionProperty: 'unset',\r\n  transitionDelay: 'unset',\r\n  transitionDuration: 'unset',\r\n  transform: 'none',\r\n  transitionTimingFunction: 'linear'\r\n})\r\n\r\nconst animation = computed(() => {\r\n  return objToStyle(transitionState)\r\n})\r\n\r\nconst rootStyle = computed(() => {\r\n  const style: CSSProperties = {}\r\n  if (isDef(props.color)) {\r\n    style.color = props.color\r\n  }\r\n\r\n  if (isDef(props.backgroundColor)) {\r\n    style.background = props.backgroundColor\r\n  }\r\n\r\n  return `${objToStyle(style)}${props.customStyle}`\r\n})\r\nconst noticeBarClass = computed(() => {\r\n  const { type, wrapable, scrollable } = props\r\n\r\n  let noticeBarClasses: string[] = []\r\n  type && noticeBarClasses.push(`is-${type}`)\r\n\r\n  if (isHorizontal.value) {\r\n    !wrapable && !scrollable && noticeBarClasses.push('wd-notice-bar--ellipse')\r\n  } else {\r\n    noticeBarClasses.push('wd-notice-bar--ellipse')\r\n  }\r\n\r\n  wrapable && !scrollable && noticeBarClasses.push('wd-notice-bar--wrap')\r\n  return noticeBarClasses.join(' ')\r\n})\r\n\r\nconst { proxy } = getCurrentInstance() as any\r\n\r\nwatch(\r\n  () => props.text,\r\n  () => {\r\n    reset()\r\n  },\r\n  { deep: true }\r\n)\r\n\r\nonMounted(() => {\r\n  startTransition()\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n})\r\n\r\nonActivated(() => {\r\n  startTransition()\r\n})\r\n\r\nonDeactivated(() => {\r\n  stopTransition()\r\n})\r\n\r\nfunction reset() {\r\n  stopTransition()\r\n  startTransition()\r\n}\r\n\r\nfunction startTransition() {\r\n  nextTick(() => scroll())\r\n}\r\n\r\nfunction stopTransition() {\r\n  transitionState.transitionProperty = 'unset'\r\n  transitionState.transitionDelay = 'unset'\r\n  transitionState.transitionDuration = 'unset'\r\n  transitionState.transform = 'none'\r\n  transitionState.transitionTimingFunction = 'linear'\r\n  currentIndex.value = 0\r\n  verticalIndex.value = 0\r\n}\r\n\r\nfunction handleClose() {\r\n  show.value = false\r\n  emit('close')\r\n}\r\n\r\nfunction setTransition({ duration, delay, translate }: { duration: number; delay: number; translate: number }) {\r\n  transitionState.transitionProperty = 'all'\r\n  transitionState.transitionDelay = `${delay}s`\r\n  transitionState.transitionDuration = `${duration}s`\r\n  transitionState.transform = `${props.direction === 'vertical' ? 'translateY' : 'translateX'}(${translate}px)`\r\n  transitionState.transitionTimingFunction = 'linear'\r\n}\r\n\r\nfunction queryRect() {\r\n  return Promise.all([getRect($wrap, false, proxy), getRect($content, false, proxy)])\r\n}\r\n\r\nasync function verticalAnimate(height: number) {\r\n  const translate = -(height / (textArray.value.length + 1)) * (currentIndex.value + 1)\r\n  setTransition({\r\n    duration: height / (textArray.value.length + 1) / props.speed,\r\n    delay: props.delay,\r\n    translate\r\n  })\r\n}\r\n\r\nasync function scroll() {\r\n  const [wRect, cRect] = await queryRect()\r\n  if (!wRect.width || !cRect.width || !cRect.height) return\r\n  wrapRect.value = wRect\r\n  contentRect.value = cRect\r\n  wrapWidth.value = wRect.width\r\n\r\n  if (isHorizontal.value) {\r\n    if (props.scrollable) {\r\n      setTransition({\r\n        duration: cRect.width / props.speed,\r\n        delay: props.delay,\r\n        translate: -cRect.width\r\n      })\r\n    }\r\n  } else {\r\n    if (textArray.value.length > 1) {\r\n      verticalAnimate(cRect.height)\r\n    }\r\n  }\r\n}\r\n\r\nfunction next() {\r\n  if (currentIndex.value >= textArray.value.length - 1) {\r\n    currentIndex.value = 0\r\n  } else {\r\n    currentIndex.value++\r\n  }\r\n  emit('next', currentIndex.value)\r\n}\r\n\r\nfunction animationEnd() {\r\n  if (isHorizontal.value) {\r\n    setTransition({\r\n      duration: 0,\r\n      delay: 0,\r\n      translate: wrapWidth.value + 1\r\n    })\r\n  } else {\r\n    if (++verticalIndex.value >= textArray.value.length) {\r\n      verticalIndex.value = 0\r\n      setTransition({\r\n        duration: 0,\r\n        delay: 0,\r\n        translate: 0\r\n      })\r\n    }\r\n  }\r\n\r\n  const timer = setTimeout(() => {\r\n    next() // 更换下一条文本\r\n\r\n    nextTick(async () => {\r\n      try {\r\n        const [wRect, cRect] = await queryRect()\r\n        wrapRect.value = wRect\r\n        contentRect.value = cRect\r\n        wrapWidth.value = wRect.width || 0\r\n      } catch (error) {\r\n        // uni.__f__('error','at uni_modules/wot-design-uni/components/wd-notice-bar/wd-notice-bar.vue:228',error)\r\n      }\r\n\r\n      if (!contentRect.value || !contentRect.value.width || !contentRect.value.height) return\r\n\r\n      if (isHorizontal.value) {\r\n        setTransition({\r\n          duration: (wrapWidth.value + contentRect.value.width) / props.speed,\r\n          delay: props.delay,\r\n          translate: -contentRect.value.width\r\n        })\r\n      } else {\r\n        verticalAnimate(contentRect.value.height)\r\n      }\r\n    })\r\n\r\n    clearTimeout(timer)\r\n  }, 20)\r\n}\r\n\r\nfunction handleClick() {\r\n  const result = isArray(props.text)\r\n    ? {\r\n        index: currentIndex.value,\r\n        text: props.text[currentIndex.value]\r\n      }\r\n    : {\r\n        index: 0,\r\n        text: props.text\r\n      }\r\n  emit('click', result)\r\n}\r\n\r\ndefineExpose<NoticeBarExpose>({ reset })\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import './index.scss';\r\n</style>\r\n","import Component from 'F:/yunsoo_mobile/uni_modules/wot-design-uni/components/wd-notice-bar/wd-notice-bar.vue'\nwx.createComponent(Component)"],"names":["ref","computed","reactive","objToStyle","isDef","getCurrentInstance","watch","onMounted","onActivated","onDeactivated","nextTick","getRect","isArray"],"mappings":"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"}