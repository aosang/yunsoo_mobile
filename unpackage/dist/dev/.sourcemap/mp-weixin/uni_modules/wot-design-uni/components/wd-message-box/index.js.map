{"version":3,"file":"index.js","sources":["uni_modules/wot-design-uni/components/wd-message-box/index.ts"],"sourcesContent":["/*\r\n * @Author: weisheng\r\n * @Date: 2022-12-14 17:33:21\r\n * @LastEditTime: 2024-12-05 13:23:17\r\n * @LastEditors: weisheng\r\n * @Description:\r\n * @FilePath: \\wot-design-uni\\src\\uni_modules\\wot-design-uni\\components\\wd-message-box\\index.ts\r\n * 记得注释\r\n */\r\nimport { inject, provide, ref } from 'vue'\r\nimport type { Message, MessageOptions, MessageOptionsWithCallBack, MessageResult, MessageType } from './types'\r\nimport { deepMerge } from '../common/util'\r\n\r\nconst messageDefaultOptionKey = '__MESSAGE_OPTION__'\r\n\r\nconst None = Symbol('None')\r\n\r\n// 默认模板\r\nexport const defaultOptions: MessageOptionsWithCallBack = {\r\n  title: '',\r\n  showCancelButton: false,\r\n  show: false,\r\n  closeOnClickModal: true,\r\n  msg: '',\r\n  type: 'alert',\r\n  inputType: 'text',\r\n  inputValue: '',\r\n  showErr: false,\r\n  zIndex: 99,\r\n  lazyRender: true,\r\n  inputError: ''\r\n}\r\n\r\nexport function useMessage(selector: string = ''): Message {\r\n  const messageOptionKey = selector ? messageDefaultOptionKey + selector : messageDefaultOptionKey\r\n  const messageOption = inject(messageOptionKey, ref<MessageOptionsWithCallBack | typeof None>(None)) // Message选项\r\n  if (messageOption.value === None) {\r\n    messageOption.value = defaultOptions\r\n    provide(messageOptionKey, messageOption)\r\n  }\r\n\r\n  const createMethod = (type: MessageType) => {\r\n    // 优先级：options->MessageOptions->defaultOptions\r\n    return (options: MessageOptions | string) => {\r\n      const messageOptions = deepMerge({ type: type }, typeof options === 'string' ? { title: options } : options) as MessageOptions\r\n      if (messageOptions.type === 'confirm' || messageOptions.type === 'prompt') {\r\n        messageOptions.showCancelButton = true\r\n      } else {\r\n        messageOptions.showCancelButton = false\r\n      }\r\n      return show(messageOptions)\r\n    }\r\n  }\r\n\r\n  const show = (option: MessageOptions | string) => {\r\n    // 返回一个promise\r\n    return new Promise<MessageResult>((resolve, reject) => {\r\n      const options = deepMerge(defaultOptions, typeof option === 'string' ? { title: option } : option)\r\n      messageOption.value = deepMerge(options, {\r\n        show: true,\r\n        success: (res: MessageResult) => {\r\n          close()\r\n          resolve(res)\r\n        },\r\n        fail: (res: MessageResult) => {\r\n          close()\r\n          reject(res)\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  // 打开Alert 弹框\r\n  const alert = createMethod('alert')\r\n  // 打开Confirm 弹框\r\n  const confirm = createMethod('confirm')\r\n  // 打开Prompt 弹框\r\n  const prompt = createMethod('prompt')\r\n\r\n  const close = () => {\r\n    if (messageOption.value !== None) {\r\n      messageOption.value.show = false\r\n    }\r\n  }\r\n  return {\r\n    show,\r\n    alert,\r\n    confirm,\r\n    prompt,\r\n    close\r\n  }\r\n}\r\n\r\nexport const getMessageDefaultOptionKey = (selector: string) => {\r\n  return selector ? `${messageDefaultOptionKey}${selector}` : messageDefaultOptionKey\r\n}\r\n"],"names":["inject","ref","provide","deepMerge"],"mappings":";;;AAaA,MAAM,0BAA0B;AAEhC,MAAM,OAAO,OAAO,MAAM;AAGnB,MAAM,iBAA6C;AAAA,EACxD,OAAO;AAAA,EACP,kBAAkB;AAAA,EAClB,MAAM;AAAA,EACN,mBAAmB;AAAA,EACnB,KAAK;AAAA,EACL,MAAM;AAAA,EACN,WAAW;AAAA,EACX,YAAY;AAAA,EACZ,SAAS;AAAA,EACT,QAAQ;AAAA,EACR,YAAY;AAAA,EACZ,YAAY;AACd;AAEgB,SAAA,WAAW,WAAmB,IAAa;AACnD,QAAA,mBAAmB,WAAW,0BAA0B,WAAW;AACzE,QAAM,gBAAgBA,cAAAA,OAAO,kBAAkBC,cAAAA,IAA8C,IAAI,CAAC;AAC9F,MAAA,cAAc,UAAU,MAAM;AAChC,kBAAc,QAAQ;AACtBC,0BAAQ,kBAAkB,aAAa;AAAA,EACzC;AAEM,QAAA,eAAe,CAAC,SAAsB;AAE1C,WAAO,CAAC,YAAqC;AAC3C,YAAM,iBAAiBC,gDAAAA,UAAU,EAAE,KAAc,GAAA,OAAO,YAAY,WAAW,EAAE,OAAO,QAAQ,IAAI,OAAO;AAC3G,UAAI,eAAe,SAAS,aAAa,eAAe,SAAS,UAAU;AACzE,uBAAe,mBAAmB;AAAA,MAAA,OAC7B;AACL,uBAAe,mBAAmB;AAAA,MACpC;AACA,aAAO,KAAK,cAAc;AAAA,IAAA;AAAA,EAC5B;AAGI,QAAA,OAAO,CAAC,WAAoC;AAEhD,WAAO,IAAI,QAAuB,CAAC,SAAS,WAAW;AAC/C,YAAA,UAAUA,gDAAAA,UAAU,gBAAgB,OAAO,WAAW,WAAW,EAAE,OAAO,WAAW,MAAM;AACnF,oBAAA,QAAQA,0DAAU,SAAS;AAAA,QACvC,MAAM;AAAA,QACN,SAAS,CAAC,QAAuB;AACzB;AACN,kBAAQ,GAAG;AAAA,QACb;AAAA,QACA,MAAM,CAAC,QAAuB;AACtB;AACN,iBAAO,GAAG;AAAA,QACZ;AAAA,MAAA,CACD;AAAA,IAAA,CACF;AAAA,EAAA;AAIG,QAAA,QAAQ,aAAa,OAAO;AAE5B,QAAA,UAAU,aAAa,SAAS;AAEhC,QAAA,SAAS,aAAa,QAAQ;AAEpC,QAAM,QAAQ,MAAM;AACd,QAAA,cAAc,UAAU,MAAM;AAChC,oBAAc,MAAM,OAAO;AAAA,IAC7B;AAAA,EAAA;AAEK,SAAA;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ;AAEa,MAAA,6BAA6B,CAAC,aAAqB;AAC9D,SAAO,WAAW,GAAG,uBAAuB,GAAG,QAAQ,KAAK;AAC9D;;;;"}