{"version":3,"file":"wd-search.js","sources":["uni_modules/wot-design-uni/components/wd-search/wd-search.vue","D:/software/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RjoveXVuc29vX21vYmlsZS91bmlfbW9kdWxlcy93b3QtZGVzaWduLXVuaS9jb21wb25lbnRzL3dkLXNlYXJjaC93ZC1zZWFyY2gudnVl"],"sourcesContent":["<template>\r\n  <view :class=\"rootClass\" :style=\"customStyle\">\r\n    <view class=\"wd-search__block\">\r\n      <slot name=\"prefix\"></slot>\r\n      <view class=\"wd-search__field\">\r\n        <view v-if=\"!placeholderLeft\" :style=\"coverStyle\" class=\"wd-search__cover\" @click=\"closeCover\">\r\n          <wd-icon name=\"search\" custom-class=\"wd-search__search-icon\"></wd-icon>\r\n          <text :class=\"`wd-search__placeholder-txt ${placeholderClass}`\">{{ placeholder || translate('search') }}</text>\r\n        </view>\r\n        <wd-icon v-if=\"showInput || inputValue || placeholderLeft\" name=\"search\" custom-class=\"wd-search__search-left-icon\"></wd-icon>\r\n        <input\r\n          v-if=\"showInput || inputValue || placeholderLeft\"\r\n          :placeholder=\"placeholder || translate('search')\"\r\n          :placeholder-class=\"`wd-search__placeholder-txt ${placeholderClass}`\"\r\n          :placeholder-style=\"placeholderStyle\"\r\n          confirm-type=\"search\"\r\n          v-model=\"inputValue\"\r\n          :class=\"['wd-search__input', customInputClass]\"\r\n          @focus=\"handleFocus\"\r\n          @input=\"handleInput\"\r\n          @blur=\"handleBlur\"\r\n          @confirm=\"handleConfirm\"\r\n          :disabled=\"disabled\"\r\n          :maxlength=\"maxlength\"\r\n          :focus=\"isFocused\"\r\n        />\r\n        <wd-icon v-if=\"inputValue\" custom-class=\"wd-search__clear wd-search__clear-icon\" name=\"error-fill\" @click=\"handleClear\" />\r\n      </view>\r\n    </view>\r\n\r\n    <slot v-if=\"!hideCancel\" name=\"suffix\">\r\n      <view class=\"wd-search__cancel\" @click=\"handleCancel\">\r\n        {{ cancelTxt || translate('cancel') }}\r\n      </view>\r\n    </slot>\r\n  </view>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nexport default {\r\n  name: 'wd-search',\r\n  options: {\r\n    virtualHost: true,\r\n    addGlobalClass: true,\r\n    styleIsolation: 'shared'\r\n  }\r\n}\r\n</script>\r\n\r\n<script lang=\"ts\" setup>\r\nimport wdIcon from '../wd-icon/wd-icon.vue'\r\nimport { type CSSProperties, computed, onMounted, ref, watch } from 'vue'\r\nimport { objToStyle, pause } from '../common/util'\r\nimport { useTranslate } from '../composables/useTranslate'\r\nimport { searchProps } from './types'\r\n\r\nconst props = defineProps(searchProps)\r\nconst emit = defineEmits(['update:modelValue', 'change', 'clear', 'search', 'focus', 'blur', 'cancel'])\r\n\r\nconst { translate } = useTranslate('search')\r\n\r\nconst isFocused = ref<boolean>(false) // 是否聚焦中\r\nconst showInput = ref<boolean>(false) // 是否显示输入框 用于实现聚焦的hack\r\nconst inputValue = ref<string>('') // 输入框的值\r\nconst showPlaceHolder = ref<boolean>(true)\r\nconst clearing = ref<boolean>(false)\r\n\r\nwatch(\r\n  () => props.modelValue,\r\n  (newValue) => {\r\n    inputValue.value = newValue\r\n    if (newValue) {\r\n      showInput.value = true\r\n    }\r\n  },\r\n  { immediate: true }\r\n)\r\n\r\nwatch(\r\n  () => props.focus,\r\n  (newValue) => {\r\n    if (newValue) {\r\n      if (props.disabled) return\r\n      closeCover()\r\n    }\r\n  }\r\n)\r\n\r\nonMounted(() => {\r\n  if (props.focus) {\r\n    closeCover()\r\n  }\r\n})\r\n\r\nconst rootClass = computed(() => {\r\n  return `wd-search  ${props.light ? 'is-light' : ''}  ${props.hideCancel ? 'is-without-cancel' : ''} ${props.customClass}`\r\n})\r\n\r\nconst coverStyle = computed(() => {\r\n  const coverStyle: CSSProperties = {\r\n    display: inputValue.value === '' && showPlaceHolder.value ? 'flex' : 'none'\r\n  }\r\n\r\n  return objToStyle(coverStyle)\r\n})\r\n\r\nasync function hackFocus(focus: boolean) {\r\n  showInput.value = focus\r\n  await pause()\r\n  isFocused.value = focus\r\n}\r\n\r\nasync function closeCover() {\r\n  if (props.disabled) return\r\n  await pause(100)\r\n  showPlaceHolder.value = false\r\n  hackFocus(true)\r\n}\r\n\r\nfunction handleInput(event: any) {\r\n  inputValue.value = event.detail.value\r\n  emit('update:modelValue', event.detail.value)\r\n  emit('change', {\r\n    value: event.detail.value\r\n  })\r\n}\r\n\r\nasync function handleClear() {\r\n  inputValue.value = ''\r\n  if (props.focusWhenClear) {\r\n    clearing.value = true\r\n    isFocused.value = false\r\n  }\r\n  await pause()\r\n  if (props.focusWhenClear) {\r\n    showPlaceHolder.value = false\r\n    hackFocus(true)\r\n  } else {\r\n    showPlaceHolder.value = true\r\n    hackFocus(false)\r\n  }\r\n  emit('change', {\r\n    value: ''\r\n  })\r\n  emit('update:modelValue', '')\r\n  emit('clear')\r\n}\r\n\r\nfunction handleConfirm({ detail: { value } }: any) {\r\n  // 组件触发search事件\r\n  emit('search', {\r\n    value\r\n  })\r\n}\r\n\r\nfunction handleFocus() {\r\n  showPlaceHolder.value = false\r\n  emit('focus', {\r\n    value: inputValue.value\r\n  })\r\n}\r\n\r\nasync function handleBlur() {\r\n  // 等待150毫秒，clear执行完毕\r\n  await pause(150)\r\n  if (clearing.value) {\r\n    clearing.value = false\r\n    return\r\n  }\r\n  // 组件触发blur事件\r\n  showPlaceHolder.value = !inputValue.value\r\n  showInput.value = !showPlaceHolder.value\r\n  isFocused.value = false\r\n  emit('blur', {\r\n    value: inputValue.value\r\n  })\r\n}\r\n\r\nfunction handleCancel() {\r\n  emit('cancel', {\r\n    value: inputValue.value\r\n  })\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n@import './index.scss';\r\n</style>\r\n","import Component from 'F:/yunsoo_mobile/uni_modules/wot-design-uni/components/wd-search/wd-search.vue'\nwx.createComponent(Component)"],"names":["useTranslate","ref","watch","onMounted","computed","coverStyle","objToStyle","pause"],"mappings":"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"}