{"version":3,"file":"wd-resize.js","sources":["uni_modules/wot-design-uni/components/wd-resize/wd-resize.vue","D:/software/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RjoveXVuc29vX21vYmlsZS91bmlfbW9kdWxlcy93b3QtZGVzaWduLXVuaS9jb21wb25lbnRzL3dkLXJlc2l6ZS93ZC1yZXNpemUudnVl"],"sourcesContent":["<template>\r\n  <view :class=\"`wd-resize ${customClass}`\" :style=\"rootStyle\">\r\n    <!--插槽需要脱离父容器文档流，防止父容器固宽固高，进而导致插槽大小被被父容器限制-->\r\n    <view :id=\"resizeId\" :class=\"`wd-resize__container ${customContainerClass}`\">\r\n      <!--被监听的插槽-->\r\n      <slot />\r\n      <!--监听插槽变大-->\r\n      <scroll-view\r\n        class=\"wd-resize__wrapper\"\r\n        :scroll-y=\"true\"\r\n        :scroll-top=\"expandScrollTop\"\r\n        :scroll-x=\"true\"\r\n        :scroll-left=\"expandScrollLeft\"\r\n        @scroll=\"onScrollHandler\"\r\n      >\r\n        <view class=\"wd-resize__wrapper--placeholder\" style=\"height: 100000px; width: 100000px\"></view>\r\n      </scroll-view>\r\n      <!--监听插槽变小-->\r\n      <scroll-view\r\n        class=\"wd-resize__wrapper\"\r\n        :scroll-y=\"true\"\r\n        :scroll-top=\"shrinkScrollTop\"\r\n        :scroll-x=\"true\"\r\n        :scroll-left=\"shrinkScrollLeft\"\r\n        @scroll=\"onScrollHandler\"\r\n      >\r\n        <view class=\"wd-resize__wrapper--placeholder\" style=\"height: 250%; width: 250%\"></view>\r\n      </scroll-view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nexport default {\r\n  name: 'wd-resize',\r\n  options: {\r\n    virtualHost: true,\r\n    addGlobalClass: true,\r\n    styleIsolation: 'shared'\r\n  }\r\n}\r\n</script>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { computed, getCurrentInstance, onMounted, ref } from 'vue'\r\nimport { addUnit, objToStyle, uuid } from '../common/util'\r\nimport { resizeProps } from './types'\r\n\r\nconst props = defineProps(resizeProps)\r\nconst emit = defineEmits(['resize'])\r\n\r\nconst expandScrollTop = ref<number>(0)\r\nconst shrinkScrollTop = ref<number>(0)\r\nconst expandScrollLeft = ref<number>(0)\r\nconst shrinkScrollLeft = ref<number>(0)\r\nconst height = ref<number>(0)\r\nconst width = ref<number>(0)\r\nconst scrollEventCount = ref<number>(0)\r\n\r\nconst rootStyle = computed(() => {\r\n  const style: Record<string, string | number> = {\r\n    width: addUnit(width.value),\r\n    height: addUnit(height.value)\r\n  }\r\n  return `${objToStyle(style)}${props.customStyle}`\r\n})\r\nlet onScrollHandler = () => {}\r\nconst { proxy } = getCurrentInstance() as any\r\n\r\nconst resizeId = ref<string>(`resize${uuid()}`)\r\n\r\nonMounted(() => {\r\n  // 初始化数据获取\r\n  const query = uni.createSelectorQuery().in(proxy).select(`#${resizeId.value}`).boundingClientRect()\r\n  query.exec(([res]) => {\r\n    // 闭包记录容器高度\r\n    let lastHeight = res.height\r\n    let lastWidth = res.width\r\n    // 立即填充父容器高宽\r\n    height.value = lastHeight\r\n    width.value = lastWidth\r\n    // 监听滚动事件\r\n    onScrollHandler = () => {\r\n      const query = uni.createSelectorQuery().in(proxy).select(`#${resizeId.value}`).boundingClientRect()\r\n      query.exec(([res]) => {\r\n        // 前两次滚动事件被触发，说明 created 的修改已渲染，通知用户代码当前容器大小\r\n        if (scrollEventCount.value++ === 0) {\r\n          const result: Record<string, string | number> = {}\r\n          ;['bottom', 'top', 'left', 'right', 'height', 'width'].forEach((propName) => {\r\n            result[propName] = res[propName]\r\n          })\r\n          emit('resize', result)\r\n        }\r\n        // 滚动条拉到底部会触发两次多余的事件，屏蔽掉。\r\n        if (scrollEventCount.value < 3) return\r\n        // 手动设置父容器高宽，防止父容器坍塌\r\n        // 滚动完，重新获取容器新的高度\r\n        const newHeight = res.height\r\n        const newWidth = res.width\r\n        // 立即填充父容器高宽\r\n        height.value = newHeight\r\n        width.value = newWidth\r\n        // 宽高都改变时，只需要触发一次 size 事件\r\n        const emitStack: number[] = []\r\n        if (newHeight !== lastHeight) {\r\n          lastHeight = newHeight\r\n          emitStack.push(1)\r\n        }\r\n        if (newWidth !== lastWidth) {\r\n          lastWidth = newWidth\r\n          emitStack.push(1)\r\n        }\r\n        if (emitStack.length !== 0) {\r\n          const result: Record<string, any> = {}\r\n          ;['bottom', 'top', 'left', 'right', 'height', 'width'].forEach((propName) => {\r\n            result[propName] = res[propName]\r\n          })\r\n          emit('resize', result)\r\n        }\r\n        // 滚动条拉到底部（如果使用 nextTick 效果更佳）\r\n        scrollToBottom({\r\n          lastWidth: lastWidth,\r\n          lastHeight: lastHeight\r\n        })\r\n      })\r\n    }\r\n    // 滚动条拉到底部（如果使用 nextTick 效果更佳）\r\n    scrollToBottom({\r\n      lastWidth: lastWidth,\r\n      lastHeight: lastHeight\r\n    })\r\n  })\r\n})\r\n\r\nfunction scrollToBottom({ lastWidth, lastHeight }: { lastWidth: number; lastHeight: number }) {\r\n  expandScrollTop.value = 100000 + lastHeight\r\n  shrinkScrollTop.value = 3 * height.value + lastHeight\r\n  expandScrollLeft.value = 100000 + lastWidth\r\n  shrinkScrollLeft.value = 3 * width.value + lastWidth\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n@import './index.scss';\r\n</style>\r\n","import Component from 'F:/yunsoo_mobile/uni_modules/wot-design-uni/components/wd-resize/wd-resize.vue'\nwx.createComponent(Component)"],"names":["ref","computed","addUnit","objToStyle","getCurrentInstance","uuid","onMounted","uni","query","res"],"mappings":";;;;AAiCA,MAAA,cAAe;AAAA,EACb,MAAM;AAAA,EACN,SAAS;AAAA,IACP,aAAa;AAAA,IACb,gBAAgB;AAAA,IAChB,gBAAgB;AAAA,EAClB;AACF;;;;;;AAQA,UAAM,QAAQ;AACd,UAAM,OAAO;AAEP,UAAA,kBAAkBA,kBAAY,CAAC;AAC/B,UAAA,kBAAkBA,kBAAY,CAAC;AAC/B,UAAA,mBAAmBA,kBAAY,CAAC;AAChC,UAAA,mBAAmBA,kBAAY,CAAC;AAChC,UAAA,SAASA,kBAAY,CAAC;AACtB,UAAA,QAAQA,kBAAY,CAAC;AACrB,UAAA,mBAAmBA,kBAAY,CAAC;AAEhC,UAAA,YAAYC,cAAAA,SAAS,MAAM;AAC/B,YAAM,QAAyC;AAAA,QAC7C,OAAOC,gDAAAA,QAAQ,MAAM,KAAK;AAAA,QAC1B,QAAQA,gDAAAA,QAAQ,OAAO,KAAK;AAAA,MAAA;AAE9B,aAAO,GAAGC,gDAAAA,WAAW,KAAK,CAAC,GAAG,MAAM,WAAW;AAAA,IAAA,CAChD;AACD,QAAI,kBAAkB,MAAM;AAAA,IAAA;AACtB,UAAA,EAAE,UAAUC,cAAAA;AAElB,UAAM,WAAWJ,cAAAA,IAAY,SAASK,gDAAA,KAAA,CAAM,EAAE;AAE9CC,kBAAAA,UAAU,MAAM;AAEd,YAAM,QAAQC,cAAA,MAAI,oBAAoB,EAAE,GAAG,KAAK,EAAE,OAAO,IAAI,SAAS,KAAK,EAAE,EAAE,mBAAmB;AAClG,YAAM,KAAK,CAAC,CAAC,GAAG,MAAM;AAEpB,YAAI,aAAa,IAAI;AACrB,YAAI,YAAY,IAAI;AAEpB,eAAO,QAAQ;AACf,cAAM,QAAQ;AAEd,0BAAkB,MAAM;AACtB,gBAAMC,SAAQD,cAAA,MAAI,oBAAoB,EAAE,GAAG,KAAK,EAAE,OAAO,IAAI,SAAS,KAAK,EAAE,EAAE,mBAAmB;AAClGC,iBAAM,KAAK,CAAC,CAACC,IAAG,MAAM;AAEhB,gBAAA,iBAAiB,YAAY,GAAG;AAClC,oBAAM,SAA0C,CAAA;AAC9C,eAAA,UAAU,OAAO,QAAQ,SAAS,UAAU,OAAO,EAAE,QAAQ,CAAC,aAAa;AACpE,uBAAA,QAAQ,IAAIA,KAAI,QAAQ;AAAA,cAAA,CAChC;AACD,mBAAK,UAAU,MAAM;AAAA,YACvB;AAEA,gBAAI,iBAAiB,QAAQ;AAAG;AAGhC,kBAAM,YAAYA,KAAI;AACtB,kBAAM,WAAWA,KAAI;AAErB,mBAAO,QAAQ;AACf,kBAAM,QAAQ;AAEd,kBAAM,YAAsB,CAAA;AAC5B,gBAAI,cAAc,YAAY;AACf,2BAAA;AACb,wBAAU,KAAK,CAAC;AAAA,YAClB;AACA,gBAAI,aAAa,WAAW;AACd,0BAAA;AACZ,wBAAU,KAAK,CAAC;AAAA,YAClB;AACI,gBAAA,UAAU,WAAW,GAAG;AAC1B,oBAAM,SAA8B,CAAA;AAClC,eAAA,UAAU,OAAO,QAAQ,SAAS,UAAU,OAAO,EAAE,QAAQ,CAAC,aAAa;AACpE,uBAAA,QAAQ,IAAIA,KAAI,QAAQ;AAAA,cAAA,CAChC;AACD,mBAAK,UAAU,MAAM;AAAA,YACvB;AAEe,2BAAA;AAAA,cACb;AAAA,cACA;AAAA,YAAA,CACD;AAAA,UAAA,CACF;AAAA,QAAA;AAGY,uBAAA;AAAA,UACb;AAAA,UACA;AAAA,QAAA,CACD;AAAA,MAAA,CACF;AAAA,IAAA,CACF;AAED,aAAS,eAAe,EAAE,WAAW,cAAyD;AAC5F,sBAAgB,QAAQ,MAAS;AACjB,sBAAA,QAAQ,IAAI,OAAO,QAAQ;AAC3C,uBAAiB,QAAQ,MAAS;AACjB,uBAAA,QAAQ,IAAI,MAAM,QAAQ;AAAA,IAC7C;;;;;;;;;;;;;;;;;;;;;;;;AC1IA,GAAG,gBAAgB,SAAS;"}