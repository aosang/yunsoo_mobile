{"version":3,"file":"request.js","sources":["request/request.js"],"sourcesContent":["const baseUrl = 'http://192.168.8.5:3000'\r\n// const baseUrl = 'http://192.168.8.63:3000'\r\n// const baseUrl = 'http://5dzb8cgi.beesnat.com'\r\nimport { userInfoStore } from \"@/stores/userInfo\"\r\n\r\nexport const requestMethods = (url, method, data = {}, timeout = 20000) => {\r\n\tconst userStore = userInfoStore()\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tuni.request({\r\n\t\t\turl: baseUrl + url,\r\n\t\t\tmethod: method,\r\n\t\t\tdata: data,\r\n\t\t\theader: {\r\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\r\n\t\t\t\t'authorization': userStore.token? userStore.token : null\r\n\t\t\t},\r\n\t\t\t// 请求响应\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tconst { statusCode, data } = res\r\n\t\t\t\tif (statusCode === 200) {\r\n\t\t\t\t\tresolve(data)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: data?.message || '请求失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tconsole.log(data);\r\n\t\t\t\t\t// uni.reLaunch({\r\n\t\t\t\t\t// \turl: '/pages/login/login'\r\n\t\t\t\t\t// })\r\n\t\t\t\t\treject(data)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfail: (err) => {\r\n\t\t\t\tif(err.errMsg.includes('timeout')) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '请求超时',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '网络请求失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\treject(err)\r\n\t\t\t}\r\n\t\t})\r\n\t})\r\n}\r\n\r\nexport const uploadMethods  = (url, filePath, formData = {}, timeout = 20000) => {\r\n\tconst userStore = userInfoStore()\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tuni.uploadFile({\r\n\t\t\turl: baseUrl + url,\r\n\t\t\tfilePath,\r\n\t\t\tname: 'file',\r\n\t\t\tformData,\r\n\t\t\theader: {\r\n\t\t\t\t'authorization': userStore.token? userStore.token : null\r\n\t\t\t},\r\n\t\t\t// 请求响应\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst data = JSON.parse(res.data) // 上传接口返回的 data 通常是字符串，要 parse\r\n\t\t\t\t\tresolve(data)\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error('上传返回解析失败', res.data)\r\n\t\t\t\t\treject(new Error('上传返回格式异常'))\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfail: (err) => {\r\n\t\t\t\tif(err.errMsg.includes('timeout')) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '文件上传超时',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '文件上传失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\treject(err)\r\n\t\t\t}\r\n\t\t})\r\n\t})\r\n}"],"names":["userInfoStore","uni","data"],"mappings":";;;AAAA,MAAM,UAAU;AAKJ,MAAC,iBAAiB,CAAC,KAAK,QAAQ,OAAO,CAAE,GAAE,UAAU,QAAU;AAC1E,QAAM,YAAYA,gBAAAA,cAAe;AACjC,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvCC,kBAAAA,MAAI,QAAQ;AAAA,MACX,KAAK,UAAU;AAAA,MACf;AAAA,MACA;AAAA,MACA,QAAQ;AAAA,QACP,gBAAgB;AAAA,QAChB,iBAAiB,UAAU,QAAO,UAAU,QAAQ;AAAA,MACpD;AAAA;AAAA,MAED,SAAS,CAAC,QAAQ;AACjB,cAAM,EAAE,YAAY,MAAAC,MAAI,IAAK;AAC7B,YAAI,eAAe,KAAK;AACvB,kBAAQA,KAAI;AAAA,QACjB,OAAW;AACND,wBAAAA,MAAI,UAAU;AAAA,YACb,QAAOC,SAAA,gBAAAA,MAAM,YAAW;AAAA,YACxB,MAAM;AAAA,UACZ,CAAM;AACDD,wBAAAA,MAAA,MAAA,OAAA,4BAAYC,KAAI;AAIhB,iBAAOA,KAAI;AAAA,QACX;AAAA,MACD;AAAA,MACD,MAAM,CAAC,QAAQ;AACd,YAAG,IAAI,OAAO,SAAS,SAAS,GAAG;AAClCD,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,UACZ,CAAM;AAAA,QACN,OAAU;AACLA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,UACZ,CAAM;AAAA,QACD;AACD,eAAO,GAAG;AAAA,MACV;AAAA,IACJ,CAAG;AAAA,EACH,CAAE;AACF;AAEY,MAAC,gBAAiB,CAAC,KAAK,UAAU,WAAW,CAAE,GAAE,UAAU,QAAU;AAChF,QAAM,YAAYD,gBAAAA,cAAe;AACjC,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvCC,kBAAAA,MAAI,WAAW;AAAA,MACd,KAAK,UAAU;AAAA,MACf;AAAA,MACA,MAAM;AAAA,MACN;AAAA,MACA,QAAQ;AAAA,QACP,iBAAiB,UAAU,QAAO,UAAU,QAAQ;AAAA,MACpD;AAAA;AAAA,MAED,SAAS,CAAC,QAAQ;AACjB,YAAI;AACH,gBAAM,OAAO,KAAK,MAAM,IAAI,IAAI;AAChC,kBAAQ,IAAI;AAAA,QACZ,SAAQ,GAAG;AACXA,wBAAA,MAAA,MAAA,SAAA,4BAAc,YAAY,IAAI,IAAI;AAClC,iBAAO,IAAI,MAAM,UAAU,CAAC;AAAA,QAC5B;AAAA,MACD;AAAA,MACD,MAAM,CAAC,QAAQ;AACd,YAAG,IAAI,OAAO,SAAS,SAAS,GAAG;AAClCA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,UACZ,CAAM;AAAA,QACN,OAAU;AACLA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,UACZ,CAAM;AAAA,QACD;AACD,eAAO,GAAG;AAAA,MACV;AAAA,IACJ,CAAG;AAAA,EACH,CAAE;AACF;;;"}